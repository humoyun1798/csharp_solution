/*
 Navicat MySQL Data Transfer

 Source Server         : 我的test
 Source Server Type    : MySQL
 Source Server Version : 80029
 Source Host           : localhost:3306
 Source Schema         : js_file

 Target Server Type    : MySQL
 Target Server Version : 80029
 File Encoding         : 65001

 Date: 08/08/2024 16:57:22
*/

SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

-- ----------------------------
-- Table structure for file
-- ----------------------------
DROP TABLE IF EXISTS `file`;
CREATE TABLE `file`  (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL DEFAULT NULL,
  `content` text CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NULL,
  `datetime` datetime NULL DEFAULT NULL,
  PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 12 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_0900_ai_ci ROW_FORMAT = Dynamic;

-- ----------------------------
-- Records of file
-- ----------------------------
INSERT INTO `file` VALUES (1, '测试1', '11112222', '2024-08-06 15:07:16');
INSERT INTO `file` VALUES (2, '测试1', '11112222555', '2024-08-06 15:07:16');
INSERT INTO `file` VALUES (3, '测试1', '11112222555jiejiejei', '2024-08-07 15:07:16');
INSERT INTO `file` VALUES (4, 'pageFollowpc.js', '', '2024-08-08 15:13:03');
INSERT INTO `file` VALUES (5, 'pageFollowpc.js', '', '2024-08-08 15:24:00');
INSERT INTO `file` VALUES (6, 'pageFollowpc.js', '', '2024-08-08 15:24:20');
INSERT INTO `file` VALUES (7, 'pageFollowpc.js', '', '2024-08-08 15:27:04');
INSERT INTO `file` VALUES (8, 'pageFollowpc.js', '', '2024-08-08 15:27:10');
INSERT INTO `file` VALUES (9, 'pageFollowpc.js', '// 专页灌粉\r\n// parseInt(Math.random() * hotStr.length)  随机访问\r\nif (CDC.getCache(\"data\") == null || CDC.getCache(\"data\") == \"\") {\r\n    CDC.setCache(\"data\", \"\");\r\n}\r\n\r\nif (CDC.getCache(\"flag\") == null || CDC.getCache(\"flag\") == \"\") {\r\n    CDC.setCache(\"flag\", \"0\");\r\n}//0 主任务，1 type=0，2 type=1\r\nif (CDC.getCache(\"ingoal\") == null || CDC.getCache(\"ingoal\") == \"\") {\r\n    CDC.setCache(\"ingoal\", \"0\");\r\n}\r\nif (CDC.getCache(\"type\") == null || CDC.getCache(\"type\") == \"\") {\r\n    CDC.setCache(\"type\", \"0\");\r\n}//0个人；1专页\r\n\r\n\r\nif (CDC.getCache(\"count\") == null || CDC.getCache(\"count\") == \"\") {\r\n    CDC.setCache(\"count\", \"0\");\r\n}\r\n\r\n\r\nasync function StartTask() {\r\n\r\n    if (location.href.indexOf(\"checkpoint\") != -1) {\r\n\r\n        $Log(\"账号被封\")\r\n        await callbackLoginStatus(1, -1);\r\n        await callbackFollow(-1);\r\n\r\n        await wait(8);\r\n\r\n        CEFBG.closeByError();\r\n    } else if ($j(\"._6ltg button._6lth\").length > 0 && is_login == 1) {\r\n        // $Log(\"账号没cookie\")\r\n        // await callbackLoginStatus(0,0);\r\n        // await callbackFollow(-1);\r\n        // await wait(8);\r\n        // CEFBG.closeByError();\r\n\r\n        await Login();\r\n    } else {\r\n        if ($j(\"._6ltg button._6lth\").length > 0 || $j(\'#login_form\').length > 0) {\r\n            $Log(\"登陆失败\")\r\n            callbackLogs(\"登陆失败\")\r\n            await callbackLoginStatus(1, -1);\r\n            await wait(5)\r\n            CEFBG.closeByError();\r\n        } else {\r\n            $Log(\"跳转专页\");\r\n            await wait(4.6);\r\n            CDC.setCache(\"count\", \"1\");\r\n            location.href = \"https://www.facebook.com/\" + fbpageid;\r\n\r\n        }\r\n\r\n    }\r\n}\r\n\r\nasync function Login() {\r\n    await wait(1);\r\n    if ($j(\"img._1ve7 \").length > 0) {\r\n        // 第一种登录方式\r\n        $j(\"img._1ve7 \")[0].click();\r\n\r\n        var flag = await waitCondition(function () {\r\n            if ($j(\"._4t2a ._pig \").length > 0) {\r\n                return true;\r\n            } else {\r\n                return false;\r\n            }\r\n        }, 20, \"检测登入框\")\r\n\r\n        if (flag) {\r\n            $j(\"._6lux #pass\")[0].focus();\r\n            await wait(1);\r\n            CEFBG.pasteText(password);\r\n            await wait(2);\r\n            $j(\"button._31ni \")[0].click();\r\n        } else {\r\n            $j(\"._6lux #email\")[0].focus();\r\n            await wait(1.1)\r\n            CEFBG.pasteText(email);\r\n\r\n            await wait(1);\r\n            if ($j(\"._6lux #pass\").length > 0) {\r\n                $j(\"._6lux #pass\")[0].focus();\r\n                await wait(1.1)\r\n                CEFBG.pasteText(password);\r\n\r\n                await wait(1.4);\r\n                $Log(\"准备点击登录按钮\")\r\n\r\n\r\n                $j(\"._6ltg button._6lth\")[0].click();\r\n            }\r\n        }\r\n    } else {\r\n        $j(\"._6lux #email\")[0].focus();\r\n        await wait(1.1)\r\n        CEFBG.pasteText(email);\r\n\r\n        await wait(1);\r\n        if ($j(\"._6lux #pass\").length > 0) {\r\n            $j(\"._6lux #pass\")[0].focus();\r\n            await wait(1.1)\r\n            CEFBG.pasteText(password);\r\n\r\n            await wait(1.4);\r\n            $Log(\"准备点击登录按钮\")\r\n\r\n\r\n            $j(\"._6ltg button._6lth\")[0].click();\r\n        }\r\n    }\r\n}\r\n\r\n\r\nasync function follow() {\r\n\r\n    var flag = await waitCondition(function () {\r\n        if ($j(\"i.xi3auck\").length > 0 || $j(\".btwxx1t3 .taijpn5t .ak7q8e6j i.op6gxeva\").length > 0 || $j(\".x1w4ip6v i.xaj1gnb\").length > 0 || $j(\"img.xep6ejk\").length > 0 || $j(\".ed17d2qt .is65gj9g .myxxopco i.gneimcpu \").length > 0) {\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }, 20, \"检测点赞按钮是否出现\");\r\n\r\n    if (flag) {\r\n        await hasDialog()\r\n        $Log(\"点赞专页\");\r\n        await wait(4);\r\n        if ($j(\".taijpn5t .tv7at329 .a0jftqn4 .du4w35lb .ni8dbmo4 \").length > 0) {\r\n            if ($j(\".taijpn5t .tv7at329 .a0jftqn4 .du4w35lb .ni8dbmo4 \")[0].innerText == \'讚\' || $j(\".taijpn5t .tv7at329 .a0jftqn4 .du4w35lb .ni8dbmo4 \")[0].innerText == \'赞\' || $j(\".taijpn5t .tv7at329 .a0jftqn4 .du4w35lb .ni8dbmo4 \")[0].innerText == \'Like\') {\r\n                $j(\".taijpn5t .tv7at329 .a0jftqn4 .du4w35lb .ni8dbmo4 \")[0].click();\r\n            } else if ($j(\".ta1k9048 .a0jftqn4 .hytbnt81 img.lzf7d6o1\").length > 0) {\r\n                $j(\".ta1k9048 .a0jftqn4 .hytbnt81 img.lzf7d6o1\")[0].click();\r\n            } else if ($j(\".pfnyh3mw img.eb18blue\").length > 0) {\r\n                $j(\".pfnyh3mw img.eb18blue\")[0].click();\r\n            } else if ($j(\".pfnyh3mw i.op6gxeva\").length > 0) {\r\n                $j(\".pfnyh3mw i.op6gxeva\")[0].click();\r\n            }\r\n\r\n            /* else if($j(\"div[aria-label=\'讚\']\").length > 0){\r\n                $j(\"div[aria-label=\'讚\']\")[0].click();\r\n            }else if($j(\"div[aria-label=\'赞\']\").length > 0){\r\n                $j(\"div[aria-label=\'赞\']\")[0].click();\r\n            }else if($j(\"div[aria-label=\'Like\']\")){\r\n                $j(\"div[aria-label=\'Like\']\")[0].click();\r\n            } */\r\n        } else if ($j(\"i.xi3auck\").length > 0) {\r\n            if ($j(\"img.xep6ejk\").length > 0) {\r\n                $j(\"img.xep6ejk\")[0].click();\r\n\r\n            } else if ($j(\"i.xi3auck\").length > 2) {\r\n                $j(\"i.xi3auck\")[1].click() // 点赞 点了赞自动关注专页 任务完成  正常模板 \r\n            } else {\r\n                $j(\"i.xi3auck\")[$j(\"i.xi3auck\").length - 1].click()\r\n            }\r\n        } else if ($j(\".x1w4ip6v i.xaj1gnb\").length > 0) {\r\n            $j(\".x1w4ip6v i.xaj1gnb\")[0].click();   // 只有关注按钮模板\r\n        } else if ($j(\"img.xep6ejk\").length > 0) {\r\n            $j(\"img.xep6ejk\")[0].click();   // 个人主页模板\r\n        } else if ($j(\".bxhmhvbv .is65gj9g .myxxopco i.ln9jdtaq \").length > 0) {\r\n            $j(\".bxhmhvbv .is65gj9g .myxxopco i.ln9jdtaq \")[0].click();\r\n        } else if ($j(\".ed17d2qt .is65gj9g .myxxopco i.gneimcpu \").length > 0) {\r\n            $j(\".ed17d2qt .is65gj9g .myxxopco i.gneimcpu \")[0].click();\r\n        }\r\n\r\n        await wait(7);\r\n        var len = $j(\".esuyzwwr .fl8dtwsd .j5wkysh0 .a57itxjd  .g0qnabr5\").length;  //已点赞的元素\r\n\r\n        if (len > 0) {\r\n            // 回调已经追踪还有更新时间\r\n            await callbackFollow(2);\r\n        } else if ($j(\"div[aria-label=\'已說讚\']\").length > 0) {\r\n            // 回调已经追踪还有更新时间\r\n            await callbackFollow(2);\r\n        } else if ($j(\"div[aria-label=\'赞了\']\").length > 0) {\r\n            await callbackFollow(2);\r\n        } else if ($j(\"div[aria-label=\'追蹤中\']\").length > 0) {\r\n            await callbackFollow(2);\r\n        } else if ($j(\"div[aria-label=\'Liked\']\").length > 0) {\r\n            await callbackFollow(2);\r\n        } else if ($j(\"div[aria-label=\'已赞\']\").length > 0) {\r\n            await callbackFollow(2);\r\n        }\r\n\r\n        await hasDialog()\r\n\r\n\r\n        await scrollLook(7, 12);\r\n\r\n        await wait(8);\r\n\r\n        CDC.setCache(\"count\", \"0\");\r\n\r\n        CDC.setCache(\"flag\", \"1\");\r\n\r\n        // await getcheckdata(0, 1)\r\n        CEFBG.close();\r\n    } else {\r\n        await callbackFollow(2);\r\n\r\n        await wait(8);\r\n\r\n        CDC.setCache(\"count\", \"0\");\r\n        CDC.setCache(\"flag\", \"1\");\r\n\r\n        CEFBG.close();\r\n        // await getcheckdata(0, 1)\r\n    }\r\n\r\n}\r\n\r\n$j(document).ready(function () {\r\n\r\n    if (CDC.getCache(\"flag\") == \"0\") {\r\n\r\n        if (CDC.getCache(\"count\") == \"0\") {\r\n            StartTask();\r\n        } else {\r\n            follow();\r\n        }\r\n\r\n\r\n    } else {\r\n\r\n        StartTask_2()\r\n\r\n    }\r\n\r\n})\r\n\r\nasync function hasDialog() {\r\n\r\n    \r\n\r\n    if($j(\'[role=\"dialog\"].x6ikm8r.x10wlt62.x71s49j\').length>0){\r\n        var text=$j(\'[role=\"dialog\"].x6ikm8r.x10wlt62.x71s49j\')[0].innerText;\r\n\r\n        if(text.includes(\"违反\")||text.includes(\"違反\")||text.includes(\"限制\") ||text.includes(\"限製\") ||text==\"\"|| text==\"确定\"||text==\"確定\" )\r\n        {\r\n            await callbackLoginStatus(1, -2);\r\n            await wait(5)\r\n            CEFBG.closeByError()\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\nasync function callbackLoginStatus(param, status) {\r\n    CEFBG.request(\"http://8.141.171.208/FansFBUser/FBUserCallback\", { id: id, is_login: param, status: status }, \"post\", \"json\", function (res) {\r\n        $Log(res);\r\n    });\r\n}\r\n\r\nasync function callbackFollow(param) {\r\n    CEFBG.request(\"http://101.201.222.226/AddFans/CbTaskState\", { id: taskid, state: param }, \"post\", \"form\", function (res) {\r\n        $Log(res);\r\n    });\r\n}\r\nasync function callbackLogs(param) {\r\n    var day = new Date();\r\n    var minutes = day.getMinutes();\r\n    minutes = minutes > 9 ? minutes : \'0\' + minutes;\r\n\r\n    var seconds = day.getSeconds();\r\n    seconds = seconds > 9 ? seconds : \'0\' + seconds;\r\n    var time = day.getFullYear() + \"/\" + (day.getMonth() + 1) + \"/\" + day.getDate() + \" \" + day.getHours() + \":\" + minutes + \":\" + seconds\r\n    param = param + \" (\" + time + \")\"\r\n    CEFBG.request(\"http://101.201.222.226/callback/addUpFansLogs\", { id: taskid, log: param }, \"post\", \"form\", function (res) {\r\n        $Log(res);\r\n        $Log(\"回调日志\")\r\n    });\r\n}\r\n\r\n\r\n//采集状态\r\nasync function StartTask_2() {\r\n\r\n\r\n    if ($j(\'[href=\"/login/\"]\').length > 0) {\r\n        $Log(\"没登录\")\r\n        await wait(2)\r\n        CEFBG.close()\r\n    }\r\n\r\n    await hasDialog()\r\n\r\n    var res1 = JSON.parse(CDC.getCache(\"data\"))\r\n    $Log(\"有数据\")\r\n    var data = res1.data\r\n    await wait(1)\r\n    if (data.length > 0) {\r\n        var url_2 = data[parseInt(CDC.getCache(\"count\"))].url;\r\n        if (CDC.getCache(\"type\") == \"0\") {\r\n            $Log(\"========================账号\")\r\n\r\n            if ($j(\'.xxbr6pl.x1p5oq8j\').length > 0 || $j(\'[role=\"link\"][href$=\"help\"]\').length > 0) {\r\n                if ($j(\'.xxbr6pl.x1p5oq8j\')[0].innerHTML.indexOf(\"已被移除\") > -1 || $j(\'.xxbr6pl.x1p5oq8j\')[0].innerHTML.indexOf(\"删除了\") > -1 || $j(\'.xxbr6pl.x1p5oq8j\')[0].innerHTML.indexOf(\"刪除\") > -1 || $j(\'[role=\"link\"][href$=\"help\"]\').length > 0) {\r\n                    $Log(\'=============内容无法显示================\')\r\n\r\n                    await wait(1)\r\n                    var id = data[parseInt(CDC.getCache(\"count\"))].id\r\n                    var param = {\r\n                        type: 0,\r\n                        id: id,\r\n                        state: 0,\r\n\r\n                    }\r\n                    await wait(2)\r\n\r\n                    await updatecheckstate(param, url_2)\r\n\r\n                }\r\n            } else {\r\n\r\n                $Log(\"开始传数据\")\r\n\r\n                await wait(1)\r\n                var fbid = 0\r\n                var fans = 0\r\n                if (data[parseInt(CDC.getCache(\"count\"))].url.indexOf(\'id=\') > -1)\r\n                    fbid = data[parseInt(CDC.getCache(\"count\"))].url.split(\'id=\')[1]\r\n\r\n                if ($j(\'.x1l90r2v.x1ve1bff .x1cy8zhl.xyamay9 span a[href*=\"/friends/\"]\').length > 0) {\r\n                    fans = $j(\'.x1l90r2v.x1ve1bff .x1cy8zhl.xyamay9 span a[href*=\"/friends/\"]\')[0].innerText.split(\' \')[0]\r\n                    if (fans.indexOf(\',\') > -1) {\r\n                        fans = fans.replace(/,/g, \'\')\r\n                    }\r\n\r\n                } else {\r\n                    fans = 0\r\n                }\r\n\r\n\r\n                var id = data[parseInt(CDC.getCache(\"count\"))].id\r\n                var param = {\r\n                    type: 0,\r\n                    id: id,\r\n                    state: 1,\r\n                    fbid: fbid,\r\n                    fans: fans\r\n                }\r\n                await wait(2)\r\n\r\n                await updatecheckstate(param, url_2)\r\n\r\n\r\n\r\n\r\n            }\r\n        } else if (CDC.getCache(\"type\") == \"1\") {\r\n            $Log(\"========================专页\")\r\n\r\n            var url_2 = data[parseInt(CDC.getCache(\"count\"))].url;\r\n            if ($j(\'.xxbr6pl.x1p5oq8j\').length > 0 || $j(\'[role=\"link\"][href$=\"help\"]\').length > 0) {\r\n                if ($j(\'.xxbr6pl.x1p5oq8j\')[0].innerHTML.indexOf(\"已被移除\") > -1 || $j(\'.xxbr6pl.x1p5oq8j\')[0].innerHTML.indexOf(\"删除了\") > -1 || $j(\'.xxbr6pl.x1p5oq8j\')[0].innerHTML.indexOf(\"刪除\") > -1 || $j(\'[role=\"link\"][href$=\"help\"]\').length > 0) {\r\n                    $Log(\'=============内容无法显示================\')\r\n                    var id = data[parseInt(CDC.getCache(\"count\"))].id\r\n                    var param = {\r\n                        type: 1,\r\n                        id: id,\r\n                        state: 0,\r\n                    }\r\n                    await wait(2)\r\n\r\n                    await updatecheckstate(param, url_2)\r\n\r\n\r\n\r\n\r\n                }\r\n            } else {\r\n                await wait(1, \"flag=2\")\r\n                var fbid = data[parseInt(CDC.getCache(\"count\"))].pageid\r\n                var fans = 0;\r\n                if ($j(\'.x1l90r2v.x1ve1bff .x1cy8zhl.xyamay9 span a[href*=\"followers\"]\').length > 0) {\r\n                    fans = getFansText($j(\'.x1l90r2v.x1ve1bff .x1cy8zhl.xyamay9 span a[href*=\"followers\"]\')[0].innerText)\r\n                } else if ($j(\'[class=\"x1jx94hy x78zum5 xdt5ytf\"] div.x78zum5.xdt5ytf.xl56j7k\').length > 0) {\r\n\r\n                    if ($j(\'[class=\"x1jx94hy x78zum5 xdt5ytf\"] div.x78zum5.xdt5ytf.xl56j7k\').length > 1) {\r\n                        fans = getFansText($j(\'[class=\"x1jx94hy x78zum5 xdt5ytf\"] div.x78zum5.xdt5ytf.xl56j7k\')[1].innerText)\r\n                    } else {\r\n                        fans = getFansText($j(\'[class=\"x1jx94hy x78zum5 xdt5ytf\"] div.x78zum5.xdt5ytf.xl56j7k\')[0].innerText)\r\n                    }\r\n                }\r\n\r\n\r\n                var id = data[parseInt(CDC.getCache(\"count\"))].id\r\n                var param = {\r\n                    type: 1,\r\n                    id: id,\r\n                    state: 1,\r\n                    fbid: fbid,\r\n                    fans: fans\r\n                }\r\n                await wait(2)\r\n                await updatecheckstate(param, url_2)\r\n\r\n\r\n\r\n            }\r\n\r\n\r\n        } else {\r\n            $Log(\"任务完成\")\r\n        }\r\n    } else {\r\n\r\n        $Log(\"type：\" + CDC.getCache(\"type\"))\r\n        await wait(4)\r\n        CEFBG.close()\r\n        // $Log(\"结束\")\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n//获取任务\r\n\r\n// type={1为专页 0为账号}\r\nasync function getcheckdata(type, count) {\r\n    CEFBG.request(\"http://fb.zhentoo.com/api/getcheckdata\", { type: type, count: count }, \"post\", \"form\", async function (res) {\r\n        $Log(\"数据\" + res)\r\n        CDC.setCache(\"data\", res);\r\n        await wait(1)\r\n        var data = JSON.parse(res).data\r\n        window.location = data[parseInt(CDC.getCache(\"count\"))].url\r\n    });\r\n}\r\n// http://fb.zhentoo.com/api/updatecheckstate?type={1为专页 0为账号}&id=&state={1正常 0异常}&fbid={long类型}&fans={专页粉丝数}\r\n// {type:type,id:id,state:state,fbid:fbid,fans:fans}\r\n//回调采集任务\r\nasync function updatecheckstate(param, url) {\r\n\r\n    \r\n    if (window.location.href.indexOf(\"chrome-error\") > -1) {\r\n        $Log(\"===本地链接有问题直接关了===\")\r\n        callbackLogs(\" fbid:\" + param.fbid + \"。link:\" + url + \"。state:\" + param.state + \"本地连接:\" + window.location.href + \";本地链接有问题直接关了\")\r\n        CEFBG.close()\r\n    } else {\r\n        $Log(\"回调\")\r\n        $Log(JSON.stringify(param))\r\n        CEFBG.request(\"http://fb.zhentoo.com/api/updatecheckstate\", param, \"post\", \"form\", async function (res) {\r\n            $Log(res);\r\n            // res1=JSON.parse(res)\r\n            // $Log(\"数据\"+res1.data)\r\n            if (param.type == 1) {\r\n                $Log(\"==========专页\")\r\n            }\r\n            else if (param.type == 0) {\r\n                $Log(\"==========账号\")\r\n\r\n            }\r\n            callbackLogs(\" fbid:\" + param.fbid + \"。link:\" + url + \"。state:\" + param.state + \"本地连接:\" + window.location.href + \";\")\r\n\r\n            $Log(\"    id: \" + param.id)\r\n            $Log(\"  fbid: \" + param.fbid + \" state: \" + param.state)\r\n            $Log(\" state: \" + param.state)\r\n            $Log(\"粉丝数: \" + param.fans)\r\n            $Log(\"  类型: \" + param.type)\r\n            var n = parseInt(CDC.getCache(\"type\")) + 1;\r\n            CDC.setCache(\"type\", n.toString())\r\n            CDC.setCache(\"data\", \"\");\r\n            CDC.setCache(\"count\", \"0\")\r\n            await scrollLook(5, 8);\r\n            await wait(4)\r\n            if (CDC.getCache(\"type\") == \"2\") {\r\n                CEFBG.close()\r\n                // $Log(\"结束\")\r\n            } else if (CDC.getCache(\"type\") == \"1\") {\r\n                await getcheckdata(1, 1)\r\n            }\r\n\r\n        });\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n// 等待时间\r\nasync function wait(s, w = \'\') {\r\n    let t = s\r\n    if (t >= 60) {\r\n        t = t / 60\r\n        t = t.toFixed(2)\r\n        $Log(`开始脚本等待` + t + \"分,\" + w);\r\n    } else {\r\n        $Log(`开始脚本等待` + t + \"秒,\" + w);\r\n    }\r\n    return new Promise(resolve => {\r\n        setTimeout(function () {\r\n            $Log(`结束脚本等待${t},` + w);\r\n            resolve();\r\n        }, s * 1000);\r\n    });\r\n}\r\n\r\n// 下拉最后回到开头\r\nasync function scrollLook(min, max, callback, delay) {\r\n    var delaytime = delay != null && delay > 0 ? delay : 2000\r\n    var math = Math.ceil(Math.random() * (max - min)) + min;\r\n    $Log(\"滑动\" + math)\r\n    for (var i = 1; i < math + 1; i++) {\r\n        (function (i) {\r\n            setTimeout(() => {\r\n                $Log(\'---滚动-->\' + i)\r\n                $j(\'html,body\').animate({\r\n                    scrollTop: i * 700\r\n                })\r\n\r\n                if (i === math) {\r\n                    $j(\'html,body\').animate({\r\n                        scrollTop: 0\r\n                    })\r\n                    if (callback != null) {\r\n                        callback()\r\n                    }\r\n\r\n                }\r\n            }, i * delaytime)\r\n        })(i)\r\n    }\r\n}\r\n\r\n\r\nfunction waitCondition(check_func, max_sec, msg) {\r\n    msg = msg ? `(${msg})` : \'\';\r\n    $Log(msg + \" 条件检测 【开始】 最多等待\" + max_sec + \" 秒\");\r\n    return new Promise(resolve => {\r\n        var count = 0;\r\n        var inteval = setInterval(function () {\r\n            var state = check_func();\r\n            count++;\r\n            if (state) {\r\n                $Log(msg + \' 条件检测 【结束】 耗时 \' + count + \" 秒\");\r\n                resolve(true);\r\n                clearInterval(inteval);\r\n            } else {\r\n                $Log(msg + \' 条件检测 【进行中】......\');\r\n            }\r\n            if (count > max_sec) {\r\n                $Log(msg + \' 条件检测 【超时】!!!!!!\');\r\n                resolve(false);//失败\r\n                clearInterval(inteval);\r\n            }\r\n        }, 1000);\r\n    });\r\n\r\n}\r\n// 101461212656826\r\n\r\n// 9,888人在追蹤\r\n\r\n// var fans=0\r\n// $j(\'[class=\"x1jx94hy x78zum5 xdt5ytf\"] div.x78zum5.xdt5ytf.xl56j7k\')[1].innerText;\r\n// fans=$j(\'.x1l90r2v.x1ve1bff .x1cy8zhl.xyamay9 span a[href*=\"followers\"]\')[0].innerText\r\n// getFansText(fans)\r\n\r\n\r\nfunction getFansText(fans) {\r\n\r\n\r\n    if (fans.indexOf(\'位\') > -1 || fans.indexOf(\'人\') > -1) {\r\n        if (fans.indexOf(\'位\') > -1) {\r\n            fans = fans.split(\'位\')[0]\r\n\r\n            fans = dealFansNum(fans)\r\n\r\n        } else if (fans.indexOf(\'人\') > -1) {\r\n            fans = fans.split(\'人\')[0]\r\n\r\n            fans = dealFansNum(fans)\r\n        }\r\n\r\n\r\n\r\n        $Log(\"fans_1\" + fans)\r\n        return fans;\r\n\r\n    } else if (fans.indexOf(\'followers\') > -1) {\r\n        fans = fans.split(\'followers\')[0]\r\n        fans = dealFansNum(fans)\r\n\r\n        $Log(\"fans_1_2\" + fans)\r\n        return fans;\r\n    }\r\n    else if (fans.indexOf(\'people\') > -1) {\r\n        fans = fans.split(\'people\')[0]\r\n        fans = dealFansNum(fans)\r\n\r\n        $Log(\"fans_1_3\" + fans)\r\n        return fans;\r\n    } else {\r\n        $Log(\"fans_1_4\" + fans)\r\n\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n}\r\n\r\nfunction dealFansNum(fans) {\r\n\r\n    if (fans.indexOf(\",\") > -1) {\r\n        fans = fans.replace(/,/g, \'\')\r\n\r\n\r\n    }\r\n    var fans_1 = 0\r\n    if (fans.indexOf(\' \')) {\r\n\r\n        fans_1 = fans.split(\' \')[0]\r\n        $Log(fans)\r\n\r\n    } else if (fans.indexOf(\' \')) {\r\n\r\n        fans_1 = fans.split(\' \')[0]\r\n        $Log(fans)\r\n\r\n    } else {\r\n\r\n        $Log(fans)\r\n\r\n    }\r\n\r\n    if (fans.indexOf(\"万\") > -1 || fans.indexOf(\"萬\") > -1) {\r\n\r\n        $Log(parseFloat(fans_1) * 10000);\r\n\r\n        fans_1 = parseFloat(fans_1) * 10000\r\n    } else if (fans.indexOf(\"K\") > -1) {\r\n        $Log(parseFloat(fans_1) * 1000);\r\n\r\n        fans_1 = parseFloat(fans_1) * 1000\r\n\r\n    } else if (fans.indexOf(\"M\") > -1) {\r\n\r\n        $Log(parseFloat(fans_1) * 1000000);\r\n\r\n        fans_1 = parseFloat(fans_1) * 1000000\r\n    }\r\n\r\n    return fans_1;\r\n\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n', '2024-08-08 16:37:17');
INSERT INTO `file` VALUES (10, 'pageFollowpc.js', '// 专页灌粉\r\n// parseInt(Math.random() * hotStr.length)  随机访问\r\nif (CDC.getCache(\"data\") == null || CDC.getCache(\"data\") == \"\") {\r\n    CDC.setCache(\"data\", \"\");\r\n}\r\n\r\nif (CDC.getCache(\"flag\") == null || CDC.getCache(\"flag\") == \"\") {\r\n    CDC.setCache(\"flag\", \"0\");\r\n}//0 主任务，1 type=0，2 type=1\r\nif (CDC.getCache(\"ingoal\") == null || CDC.getCache(\"ingoal\") == \"\") {\r\n    CDC.setCache(\"ingoal\", \"0\");\r\n}\r\nif (CDC.getCache(\"type\") == null || CDC.getCache(\"type\") == \"\") {\r\n    CDC.setCache(\"type\", \"0\");\r\n}//0个人；1专页\r\n\r\n\r\nif (CDC.getCache(\"count\") == null || CDC.getCache(\"count\") == \"\") {\r\n    CDC.setCache(\"count\", \"0\");\r\n}\r\n\r\n\r\nasync function StartTask() {\r\n\r\n    if (location.href.indexOf(\"checkpoint\") != -1) {\r\n\r\n        $Log(\"账号被封\")\r\n        await callbackLoginStatus(1, -1);\r\n        await callbackFollow(-1);\r\n\r\n        await wait(8);\r\n\r\n        CEFBG.closeByError();\r\n    } else if ($j(\"._6ltg button._6lth\").length > 0 && is_login == 1) {\r\n        // $Log(\"账号没cookie\")\r\n        // await callbackLoginStatus(0,0);\r\n        // await callbackFollow(-1);\r\n        // await wait(8);\r\n        // CEFBG.closeByError();\r\n\r\n        await Login();\r\n    } else {\r\n        if ($j(\"._6ltg button._6lth\").length > 0 || $j(\'#login_form\').length > 0) {\r\n            $Log(\"登陆失败\")\r\n            callbackLogs(\"登陆失败\")\r\n            await callbackLoginStatus(1, -1);\r\n            await wait(5)\r\n            CEFBG.closeByError();\r\n        } else {\r\n            $Log(\"跳转专页\");\r\n            await wait(4.6);\r\n            CDC.setCache(\"count\", \"1\");\r\n            location.href = \"https://www.facebook.com/\" + fbpageid;\r\n\r\n        }\r\n\r\n    }\r\n}\r\n\r\nasync function Login() {\r\n    await wait(1);\r\n    if ($j(\"img._1ve7 \").length > 0) {\r\n        // 第一种登录方式\r\n        $j(\"img._1ve7 \")[0].click();\r\n\r\n        var flag = await waitCondition(function () {\r\n            if ($j(\"._4t2a ._pig \").length > 0) {\r\n                return true;\r\n            } else {\r\n                return false;\r\n            }\r\n        }, 20, \"检测登入框\")\r\n\r\n        if (flag) {\r\n            $j(\"._6lux #pass\")[0].focus();\r\n            await wait(1);\r\n            CEFBG.pasteText(password);\r\n            await wait(2);\r\n            $j(\"button._31ni \")[0].click();\r\n        } else {\r\n            $j(\"._6lux #email\")[0].focus();\r\n            await wait(1.1)\r\n            CEFBG.pasteText(email);\r\n\r\n            await wait(1);\r\n            if ($j(\"._6lux #pass\").length > 0) {\r\n                $j(\"._6lux #pass\")[0].focus();\r\n                await wait(1.1)\r\n                CEFBG.pasteText(password);\r\n\r\n                await wait(1.4);\r\n                $Log(\"准备点击登录按钮\")\r\n\r\n\r\n                $j(\"._6ltg button._6lth\")[0].click();\r\n            }\r\n        }\r\n    } else {\r\n        $j(\"._6lux #email\")[0].focus();\r\n        await wait(1.1)\r\n        CEFBG.pasteText(email);\r\n\r\n        await wait(1);\r\n        if ($j(\"._6lux #pass\").length > 0) {\r\n            $j(\"._6lux #pass\")[0].focus();\r\n            await wait(1.1)\r\n            CEFBG.pasteText(password);\r\n\r\n            await wait(1.4);\r\n            $Log(\"准备点击登录按钮\")\r\n\r\n\r\n            $j(\"._6ltg button._6lth\")[0].click();\r\n        }\r\n    }\r\n}\r\n\r\n\r\nasync function follow() {\r\n\r\n    var flag = await waitCondition(function () {\r\n        if ($j(\"i.xi3auck\").length > 0 || $j(\".btwxx1t3 .taijpn5t .ak7q8e6j i.op6gxeva\").length > 0 || $j(\".x1w4ip6v i.xaj1gnb\").length > 0 || $j(\"img.xep6ejk\").length > 0 || $j(\".ed17d2qt .is65gj9g .myxxopco i.gneimcpu \").length > 0) {\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }, 20, \"检测点赞按钮是否出现\");\r\n\r\n    if (flag) {\r\n        await hasDialog()\r\n        $Log(\"点赞专页\");\r\n        await wait(4);\r\n        if ($j(\".taijpn5t .tv7at329 .a0jftqn4 .du4w35lb .ni8dbmo4 \").length > 0) {\r\n            if ($j(\".taijpn5t .tv7at329 .a0jftqn4 .du4w35lb .ni8dbmo4 \")[0].innerText == \'讚\' || $j(\".taijpn5t .tv7at329 .a0jftqn4 .du4w35lb .ni8dbmo4 \")[0].innerText == \'赞\' || $j(\".taijpn5t .tv7at329 .a0jftqn4 .du4w35lb .ni8dbmo4 \")[0].innerText == \'Like\') {\r\n                $j(\".taijpn5t .tv7at329 .a0jftqn4 .du4w35lb .ni8dbmo4 \")[0].click();\r\n            } else if ($j(\".ta1k9048 .a0jftqn4 .hytbnt81 img.lzf7d6o1\").length > 0) {\r\n                $j(\".ta1k9048 .a0jftqn4 .hytbnt81 img.lzf7d6o1\")[0].click();\r\n            } else if ($j(\".pfnyh3mw img.eb18blue\").length > 0) {\r\n                $j(\".pfnyh3mw img.eb18blue\")[0].click();\r\n            } else if ($j(\".pfnyh3mw i.op6gxeva\").length > 0) {\r\n                $j(\".pfnyh3mw i.op6gxeva\")[0].click();\r\n            }\r\n\r\n            /* else if($j(\"div[aria-label=\'讚\']\").length > 0){\r\n                $j(\"div[aria-label=\'讚\']\")[0].click();\r\n            }else if($j(\"div[aria-label=\'赞\']\").length > 0){\r\n                $j(\"div[aria-label=\'赞\']\")[0].click();\r\n            }else if($j(\"div[aria-label=\'Like\']\")){\r\n                $j(\"div[aria-label=\'Like\']\")[0].click();\r\n            } */\r\n        } else if ($j(\"i.xi3auck\").length > 0) {\r\n            if ($j(\"img.xep6ejk\").length > 0) {\r\n                $j(\"img.xep6ejk\")[0].click();\r\n\r\n            } else if ($j(\"i.xi3auck\").length > 2) {\r\n                $j(\"i.xi3auck\")[1].click() // 点赞 点了赞自动关注专页 任务完成  正常模板 \r\n            } else {\r\n                $j(\"i.xi3auck\")[$j(\"i.xi3auck\").length - 1].click()\r\n            }\r\n        } else if ($j(\".x1w4ip6v i.xaj1gnb\").length > 0) {\r\n            $j(\".x1w4ip6v i.xaj1gnb\")[0].click();   // 只有关注按钮模板\r\n        } else if ($j(\"img.xep6ejk\").length > 0) {\r\n            $j(\"img.xep6ejk\")[0].click();   // 个人主页模板\r\n        } else if ($j(\".bxhmhvbv .is65gj9g .myxxopco i.ln9jdtaq \").length > 0) {\r\n            $j(\".bxhmhvbv .is65gj9g .myxxopco i.ln9jdtaq \")[0].click();\r\n        } else if ($j(\".ed17d2qt .is65gj9g .myxxopco i.gneimcpu \").length > 0) {\r\n            $j(\".ed17d2qt .is65gj9g .myxxopco i.gneimcpu \")[0].click();\r\n        }\r\n\r\n        await wait(7);\r\n        var len = $j(\".esuyzwwr .fl8dtwsd .j5wkysh0 .a57itxjd  .g0qnabr5\").length;  //已点赞的元素\r\n\r\n        if (len > 0) {\r\n            // 回调已经追踪还有更新时间\r\n            await callbackFollow(2);\r\n        } else if ($j(\"div[aria-label=\'已說讚\']\").length > 0) {\r\n            // 回调已经追踪还有更新时间\r\n            await callbackFollow(2);\r\n        } else if ($j(\"div[aria-label=\'赞了\']\").length > 0) {\r\n            await callbackFollow(2);\r\n        } else if ($j(\"div[aria-label=\'追蹤中\']\").length > 0) {\r\n            await callbackFollow(2);\r\n        } else if ($j(\"div[aria-label=\'Liked\']\").length > 0) {\r\n            await callbackFollow(2);\r\n        } else if ($j(\"div[aria-label=\'已赞\']\").length > 0) {\r\n            await callbackFollow(2);\r\n        }\r\n\r\n        await hasDialog()\r\n\r\n\r\n        await scrollLook(7, 12);\r\n\r\n        await wait(8);\r\n\r\n        CDC.setCache(\"count\", \"0\");\r\n\r\n        CDC.setCache(\"flag\", \"1\");\r\n\r\n        // await getcheckdata(0, 1)\r\n        CEFBG.close();\r\n    } else {\r\n        await callbackFollow(2);\r\n\r\n        await wait(8);\r\n\r\n        CDC.setCache(\"count\", \"0\");\r\n        CDC.setCache(\"flag\", \"1\");\r\n\r\n        CEFBG.close();\r\n        // await getcheckdata(0, 1)\r\n    }\r\n\r\n}\r\n\r\n$j(document).ready(function () {\r\n\r\n    if (CDC.getCache(\"flag\") == \"0\") {\r\n\r\n        if (CDC.getCache(\"count\") == \"0\") {\r\n            StartTask();\r\n        } else {\r\n            follow();\r\n        }\r\n\r\n\r\n    } else {\r\n\r\n        StartTask_2()\r\n\r\n    }\r\n\r\n})\r\n\r\nasync function hasDialog() {\r\n\r\n    \r\n\r\n    if($j(\'[role=\"dialog\"].x6ikm8r.x10wlt62.x71s49j\').length>0){\r\n        var text=$j(\'[role=\"dialog\"].x6ikm8r.x10wlt62.x71s49j\')[0].innerText;\r\n\r\n        if(text.includes(\"违反\")||text.includes(\"違反\")||text.includes(\"限制\") ||text.includes(\"限製\") ||text==\"\"|| text==\"确定\"||text==\"確定\" )\r\n        {\r\n            await callbackLoginStatus(1, -2);\r\n            await wait(5)\r\n            CEFBG.closeByError()\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\nasync function callbackLoginStatus(param, status) {\r\n    CEFBG.request(\"http://8.141.171.208/FansFBUser/FBUserCallback\", { id: id, is_login: param, status: status }, \"post\", \"json\", function (res) {\r\n        $Log(res);\r\n    });\r\n}\r\n\r\nasync function callbackFollow(param) {\r\n    CEFBG.request(\"http://101.201.222.226/AddFans/CbTaskState\", { id: taskid, state: param }, \"post\", \"form\", function (res) {\r\n        $Log(res);\r\n    });\r\n}\r\nasync function callbackLogs(param) {\r\n    var day = new Date();\r\n    var minutes = day.getMinutes();\r\n    minutes = minutes > 9 ? minutes : \'0\' + minutes;\r\n\r\n    var seconds = day.getSeconds();\r\n    seconds = seconds > 9 ? seconds : \'0\' + seconds;\r\n    var time = day.getFullYear() + \"/\" + (day.getMonth() + 1) + \"/\" + day.getDate() + \" \" + day.getHours() + \":\" + minutes + \":\" + seconds\r\n    param = param + \" (\" + time + \")\"\r\n    CEFBG.request(\"http://101.201.222.226/callback/addUpFansLogs\", { id: taskid, log: param }, \"post\", \"form\", function (res) {\r\n        $Log(res);\r\n        $Log(\"回调日志\")\r\n    });\r\n}\r\n\r\n\r\n//采集状态\r\nasync function StartTask_2() {\r\n\r\n\r\n    if ($j(\'[href=\"/login/\"]\').length > 0) {\r\n        $Log(\"没登录\")\r\n        await wait(2)\r\n        CEFBG.close()\r\n    }\r\n\r\n    await hasDialog()\r\n\r\n    var res1 = JSON.parse(CDC.getCache(\"data\"))\r\n    $Log(\"有数据\")\r\n    var data = res1.data\r\n    await wait(1)\r\n    if (data.length > 0) {\r\n        var url_2 = data[parseInt(CDC.getCache(\"count\"))].url;\r\n        if (CDC.getCache(\"type\") == \"0\") {\r\n            $Log(\"========================账号\")\r\n\r\n            if ($j(\'.xxbr6pl.x1p5oq8j\').length > 0 || $j(\'[role=\"link\"][href$=\"help\"]\').length > 0) {\r\n                if ($j(\'.xxbr6pl.x1p5oq8j\')[0].innerHTML.indexOf(\"已被移除\") > -1 || $j(\'.xxbr6pl.x1p5oq8j\')[0].innerHTML.indexOf(\"删除了\") > -1 || $j(\'.xxbr6pl.x1p5oq8j\')[0].innerHTML.indexOf(\"刪除\") > -1 || $j(\'[role=\"link\"][href$=\"help\"]\').length > 0) {\r\n                    $Log(\'=============内容无法显示================\')\r\n\r\n                    await wait(1)\r\n                    var id = data[parseInt(CDC.getCache(\"count\"))].id\r\n                    var param = {\r\n                        type: 0,\r\n                        id: id,\r\n                        state: 0,\r\n\r\n                    }\r\n                    await wait(2)\r\n\r\n                    await updatecheckstate(param, url_2)\r\n\r\n                }\r\n            } else {\r\n\r\n                $Log(\"开始传数据\")\r\n\r\n                await wait(1)\r\n                var fbid = 0\r\n                var fans = 0\r\n                if (data[parseInt(CDC.getCache(\"count\"))].url.indexOf(\'id=\') > -1)\r\n                    fbid = data[parseInt(CDC.getCache(\"count\"))].url.split(\'id=\')[1]\r\n\r\n                if ($j(\'.x1l90r2v.x1ve1bff .x1cy8zhl.xyamay9 span a[href*=\"/friends/\"]\').length > 0) {\r\n                    fans = $j(\'.x1l90r2v.x1ve1bff .x1cy8zhl.xyamay9 span a[href*=\"/friends/\"]\')[0].innerText.split(\' \')[0]\r\n                    if (fans.indexOf(\',\') > -1) {\r\n                        fans = fans.replace(/,/g, \'\')\r\n                    }\r\n\r\n                } else {\r\n                    fans = 0\r\n                }\r\n\r\n\r\n                var id = data[parseInt(CDC.getCache(\"count\"))].id\r\n                var param = {\r\n                    type: 0,\r\n                    id: id,\r\n                    state: 1,\r\n                    fbid: fbid,\r\n                    fans: fans\r\n                }\r\n                await wait(2)\r\n\r\n                await updatecheckstate(param, url_2)\r\n\r\n\r\n\r\n\r\n            }\r\n        } else if (CDC.getCache(\"type\") == \"1\") {\r\n            $Log(\"========================专页\")\r\n\r\n            var url_2 = data[parseInt(CDC.getCache(\"count\"))].url;\r\n            if ($j(\'.xxbr6pl.x1p5oq8j\').length > 0 || $j(\'[role=\"link\"][href$=\"help\"]\').length > 0) {\r\n                if ($j(\'.xxbr6pl.x1p5oq8j\')[0].innerHTML.indexOf(\"已被移除\") > -1 || $j(\'.xxbr6pl.x1p5oq8j\')[0].innerHTML.indexOf(\"删除了\") > -1 || $j(\'.xxbr6pl.x1p5oq8j\')[0].innerHTML.indexOf(\"刪除\") > -1 || $j(\'[role=\"link\"][href$=\"help\"]\').length > 0) {\r\n                    $Log(\'=============内容无法显示================\')\r\n                    var id = data[parseInt(CDC.getCache(\"count\"))].id\r\n                    var param = {\r\n                        type: 1,\r\n                        id: id,\r\n                        state: 0,\r\n                    }\r\n                    await wait(2)\r\n\r\n                    await updatecheckstate(param, url_2)\r\n\r\n\r\n\r\n\r\n                }\r\n            } else {\r\n                await wait(1, \"flag=2\")\r\n                var fbid = data[parseInt(CDC.getCache(\"count\"))].pageid\r\n                var fans = 0;\r\n                if ($j(\'.x1l90r2v.x1ve1bff .x1cy8zhl.xyamay9 span a[href*=\"followers\"]\').length > 0) {\r\n                    fans = getFansText($j(\'.x1l90r2v.x1ve1bff .x1cy8zhl.xyamay9 span a[href*=\"followers\"]\')[0].innerText)\r\n                } else if ($j(\'[class=\"x1jx94hy x78zum5 xdt5ytf\"] div.x78zum5.xdt5ytf.xl56j7k\').length > 0) {\r\n\r\n                    if ($j(\'[class=\"x1jx94hy x78zum5 xdt5ytf\"] div.x78zum5.xdt5ytf.xl56j7k\').length > 1) {\r\n                        fans = getFansText($j(\'[class=\"x1jx94hy x78zum5 xdt5ytf\"] div.x78zum5.xdt5ytf.xl56j7k\')[1].innerText)\r\n                    } else {\r\n                        fans = getFansText($j(\'[class=\"x1jx94hy x78zum5 xdt5ytf\"] div.x78zum5.xdt5ytf.xl56j7k\')[0].innerText)\r\n                    }\r\n                }\r\n\r\n\r\n                var id = data[parseInt(CDC.getCache(\"count\"))].id\r\n                var param = {\r\n                    type: 1,\r\n                    id: id,\r\n                    state: 1,\r\n                    fbid: fbid,\r\n                    fans: fans\r\n                }\r\n                await wait(2)\r\n                await updatecheckstate(param, url_2)\r\n\r\n\r\n\r\n            }\r\n\r\n\r\n        } else {\r\n            $Log(\"任务完成\")\r\n        }\r\n    } else {\r\n\r\n        $Log(\"type：\" + CDC.getCache(\"type\"))\r\n        await wait(4)\r\n        CEFBG.close()\r\n        // $Log(\"结束\")\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n//获取任务\r\n\r\n// type={1为专页 0为账号}\r\nasync function getcheckdata(type, count) {\r\n    CEFBG.request(\"http://fb.zhentoo.com/api/getcheckdata\", { type: type, count: count }, \"post\", \"form\", async function (res) {\r\n        $Log(\"数据\" + res)\r\n        CDC.setCache(\"data\", res);\r\n        await wait(1)\r\n        var data = JSON.parse(res).data\r\n        window.location = data[parseInt(CDC.getCache(\"count\"))].url\r\n    });\r\n}\r\n// http://fb.zhentoo.com/api/updatecheckstate?type={1为专页 0为账号}&id=&state={1正常 0异常}&fbid={long类型}&fans={专页粉丝数}\r\n// {type:type,id:id,state:state,fbid:fbid,fans:fans}\r\n//回调采集任务\r\nasync function updatecheckstate(param, url) {\r\n\r\n    \r\n    if (window.location.href.indexOf(\"chrome-error\") > -1) {\r\n        $Log(\"===本地链接有问题直接关了===\")\r\n        callbackLogs(\" fbid:\" + param.fbid + \"。link:\" + url + \"。state:\" + param.state + \"本地连接:\" + window.location.href + \";本地链接有问题直接关了\")\r\n        CEFBG.close()\r\n    } else {\r\n        $Log(\"回调\")\r\n        $Log(JSON.stringify(param))\r\n        CEFBG.request(\"http://fb.zhentoo.com/api/updatecheckstate\", param, \"post\", \"form\", async function (res) {\r\n            $Log(res);\r\n            // res1=JSON.parse(res)\r\n            // $Log(\"数据\"+res1.data)\r\n            if (param.type == 1) {\r\n                $Log(\"==========专页\")\r\n            }\r\n            else if (param.type == 0) {\r\n                $Log(\"==========账号\")\r\n\r\n            }\r\n            callbackLogs(\" fbid:\" + param.fbid + \"。link:\" + url + \"。state:\" + param.state + \"本地连接:\" + window.location.href + \";\")\r\n\r\n            $Log(\"    id: \" + param.id)\r\n            $Log(\"  fbid: \" + param.fbid + \" state: \" + param.state)\r\n            $Log(\" state: \" + param.state)\r\n            $Log(\"粉丝数: \" + param.fans)\r\n            $Log(\"  类型: \" + param.type)\r\n            var n = parseInt(CDC.getCache(\"type\")) + 1;\r\n            CDC.setCache(\"type\", n.toString())\r\n            CDC.setCache(\"data\", \"\");\r\n            CDC.setCache(\"count\", \"0\")\r\n            await scrollLook(5, 8);\r\n            await wait(4)\r\n            if (CDC.getCache(\"type\") == \"2\") {\r\n                CEFBG.close()\r\n                // $Log(\"结束\")\r\n            } else if (CDC.getCache(\"type\") == \"1\") {\r\n                await getcheckdata(1, 1)\r\n            }\r\n\r\n        });\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n// 等待时间\r\nasync function wait(s, w = \'\') {\r\n    let t = s\r\n    if (t >= 60) {\r\n        t = t / 60\r\n        t = t.toFixed(2)\r\n        $Log(`开始脚本等待` + t + \"分,\" + w);\r\n    } else {\r\n        $Log(`开始脚本等待` + t + \"秒,\" + w);\r\n    }\r\n    return new Promise(resolve => {\r\n        setTimeout(function () {\r\n            $Log(`结束脚本等待${t},` + w);\r\n            resolve();\r\n        }, s * 1000);\r\n    });\r\n}\r\n\r\n// 下拉最后回到开头\r\nasync function scrollLook(min, max, callback, delay) {\r\n    var delaytime = delay != null && delay > 0 ? delay : 2000\r\n    var math = Math.ceil(Math.random() * (max - min)) + min;\r\n    $Log(\"滑动\" + math)\r\n    for (var i = 1; i < math + 1; i++) {\r\n        (function (i) {\r\n            setTimeout(() => {\r\n                $Log(\'---滚动-->\' + i)\r\n                $j(\'html,body\').animate({\r\n                    scrollTop: i * 700\r\n                })\r\n\r\n                if (i === math) {\r\n                    $j(\'html,body\').animate({\r\n                        scrollTop: 0\r\n                    })\r\n                    if (callback != null) {\r\n                        callback()\r\n                    }\r\n\r\n                }\r\n            }, i * delaytime)\r\n        })(i)\r\n    }\r\n}\r\n\r\n\r\nfunction waitCondition(check_func, max_sec, msg) {\r\n    msg = msg ? `(${msg})` : \'\';\r\n    $Log(msg + \" 条件检测 【开始】 最多等待\" + max_sec + \" 秒\");\r\n    return new Promise(resolve => {\r\n        var count = 0;\r\n        var inteval = setInterval(function () {\r\n            var state = check_func();\r\n            count++;\r\n            if (state) {\r\n                $Log(msg + \' 条件检测 【结束】 耗时 \' + count + \" 秒\");\r\n                resolve(true);\r\n                clearInterval(inteval);\r\n            } else {\r\n                $Log(msg + \' 条件检测 【进行中】......\');\r\n            }\r\n            if (count > max_sec) {\r\n                $Log(msg + \' 条件检测 【超时】!!!!!!\');\r\n                resolve(false);//失败\r\n                clearInterval(inteval);\r\n            }\r\n        }, 1000);\r\n    });\r\n\r\n}\r\n// 101461212656826\r\n\r\n// 9,888人在追蹤\r\n\r\n// var fans=0\r\n// $j(\'[class=\"x1jx94hy x78zum5 xdt5ytf\"] div.x78zum5.xdt5ytf.xl56j7k\')[1].innerText;\r\n// fans=$j(\'.x1l90r2v.x1ve1bff .x1cy8zhl.xyamay9 span a[href*=\"followers\"]\')[0].innerText\r\n// getFansText(fans)\r\n\r\n\r\nfunction getFansText(fans) {\r\n\r\n\r\n    if (fans.indexOf(\'位\') > -1 || fans.indexOf(\'人\') > -1) {\r\n        if (fans.indexOf(\'位\') > -1) {\r\n            fans = fans.split(\'位\')[0]\r\n\r\n            fans = dealFansNum(fans)\r\n\r\n        } else if (fans.indexOf(\'人\') > -1) {\r\n            fans = fans.split(\'人\')[0]\r\n\r\n            fans = dealFansNum(fans)\r\n        }\r\n\r\n\r\n\r\n        $Log(\"fans_1\" + fans)\r\n        return fans;\r\n\r\n    } else if (fans.indexOf(\'followers\') > -1) {\r\n        fans = fans.split(\'followers\')[0]\r\n        fans = dealFansNum(fans)\r\n\r\n        $Log(\"fans_1_2\" + fans)\r\n        return fans;\r\n    }\r\n    else if (fans.indexOf(\'people\') > -1) {\r\n        fans = fans.split(\'people\')[0]\r\n        fans = dealFansNum(fans)\r\n\r\n        $Log(\"fans_1_3\" + fans)\r\n        return fans;\r\n    } else {\r\n        $Log(\"fans_1_4\" + fans)\r\n\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n}\r\n\r\nfunction dealFansNum(fans) {\r\n\r\n    if (fans.indexOf(\",\") > -1) {\r\n        fans = fans.replace(/,/g, \'\')\r\n\r\n\r\n    }\r\n    var fans_1 = 0\r\n    if (fans.indexOf(\' \')) {\r\n\r\n        fans_1 = fans.split(\' \')[0]\r\n        $Log(fans)\r\n\r\n    } else if (fans.indexOf(\' \')) {\r\n\r\n        fans_1 = fans.split(\' \')[0]\r\n        $Log(fans)\r\n\r\n    } else {\r\n\r\n        $Log(fans)\r\n\r\n    }\r\n\r\n    if (fans.indexOf(\"万\") > -1 || fans.indexOf(\"萬\") > -1) {\r\n\r\n        $Log(parseFloat(fans_1) * 10000);\r\n\r\n        fans_1 = parseFloat(fans_1) * 10000\r\n    } else if (fans.indexOf(\"K\") > -1) {\r\n        $Log(parseFloat(fans_1) * 1000);\r\n\r\n        fans_1 = parseFloat(fans_1) * 1000\r\n\r\n    } else if (fans.indexOf(\"M\") > -1) {\r\n\r\n        $Log(parseFloat(fans_1) * 1000000);\r\n\r\n        fans_1 = parseFloat(fans_1) * 1000000\r\n    }\r\n\r\n    return fans_1;\r\n\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n', '2024-08-08 16:37:52');
INSERT INTO `file` VALUES (11, 'pageFollowpc.js', '// 专页灌粉\r\n// parseInt(Math.random() * hotStr.length)  随机访问\r\nif (CDC.getCache(\"data\") == null || CDC.getCache(\"data\") == \"\") {\r\n    CDC.setCache(\"data\", \"\");\r\n}\r\n\r\nif (CDC.getCache(\"flag\") == null || CDC.getCache(\"flag\") == \"\") {\r\n    CDC.setCache(\"flag\", \"0\");\r\n}//0 主任务，1 type=0，2 type=1\r\nif (CDC.getCache(\"ingoal\") == null || CDC.getCache(\"ingoal\") == \"\") {\r\n    CDC.setCache(\"ingoal\", \"0\");\r\n}\r\nif (CDC.getCache(\"type\") == null || CDC.getCache(\"type\") == \"\") {\r\n    CDC.setCache(\"type\", \"0\");\r\n}//0个人；1专页\r\n\r\n\r\nif (CDC.getCache(\"count\") == null || CDC.getCache(\"count\") == \"\") {\r\n    CDC.setCache(\"count\", \"0\");\r\n}\r\n\r\n\r\nasync function StartTask() {\r\n\r\n    if (location.href.indexOf(\"checkpoint\") != -1) {\r\n\r\n        $Log(\"账号被封\")\r\n        await callbackLoginStatus(1, -1);\r\n        await callbackFollow(-1);\r\n\r\n        await wait(8);\r\n\r\n        CEFBG.closeByError();\r\n    } else if ($j(\"._6ltg button._6lth\").length > 0 && is_login == 1) {\r\n        // $Log(\"账号没cookie\")\r\n        // await callbackLoginStatus(0,0);\r\n        // await callbackFollow(-1);\r\n        // await wait(8);\r\n        // CEFBG.closeByError();\r\n\r\n        await Login();\r\n    } else {\r\n        if ($j(\"._6ltg button._6lth\").length > 0 || $j(\'#login_form\').length > 0) {\r\n            $Log(\"登陆失败\")\r\n            callbackLogs(\"登陆失败\")\r\n            await callbackLoginStatus(1, -1);\r\n            await wait(5)\r\n            CEFBG.closeByError();\r\n        } else {\r\n            $Log(\"跳转专页\");\r\n            await wait(4.6);\r\n            CDC.setCache(\"count\", \"1\");\r\n            location.href = \"https://www.facebook.com/\" + fbpageid;\r\n\r\n        }\r\n\r\n    }\r\n}\r\n\r\nasync function Login() {\r\n    await wait(1);\r\n    if ($j(\"img._1ve7 \").length > 0) {\r\n        // 第一种登录方式\r\n        $j(\"img._1ve7 \")[0].click();\r\n\r\n        var flag = await waitCondition(function () {\r\n            if ($j(\"._4t2a ._pig \").length > 0) {\r\n                return true;\r\n            } else {\r\n                return false;\r\n            }\r\n        }, 20, \"检测登入框\")\r\n\r\n        if (flag) {\r\n            $j(\"._6lux #pass\")[0].focus();\r\n            await wait(1);\r\n            CEFBG.pasteText(password);\r\n            await wait(2);\r\n            $j(\"button._31ni \")[0].click();\r\n        } else {\r\n            $j(\"._6lux #email\")[0].focus();\r\n            await wait(1.1)\r\n            CEFBG.pasteText(email);\r\n\r\n            await wait(1);\r\n            if ($j(\"._6lux #pass\").length > 0) {\r\n                $j(\"._6lux #pass\")[0].focus();\r\n                await wait(1.1)\r\n                CEFBG.pasteText(password);\r\n\r\n                await wait(1.4);\r\n                $Log(\"准备点击登录按钮\")\r\n\r\n\r\n                $j(\"._6ltg button._6lth\")[0].click();\r\n            }\r\n        }\r\n    } else {\r\n        $j(\"._6lux #email\")[0].focus();\r\n        await wait(1.1)\r\n        CEFBG.pasteText(email);\r\n\r\n        await wait(1);\r\n        if ($j(\"._6lux #pass\").length > 0) {\r\n            $j(\"._6lux #pass\")[0].focus();\r\n            await wait(1.1)\r\n            CEFBG.pasteText(password);\r\n\r\n            await wait(1.4);\r\n            $Log(\"准备点击登录按钮\")\r\n\r\n\r\n            $j(\"._6ltg button._6lth\")[0].click();\r\n        }\r\n    }\r\n}\r\n\r\n\r\nasync function follow() {\r\n\r\n    var flag = await waitCondition(function () {\r\n        if ($j(\"i.xi3auck\").length > 0 || $j(\".btwxx1t3 .taijpn5t .ak7q8e6j i.op6gxeva\").length > 0 || $j(\".x1w4ip6v i.xaj1gnb\").length > 0 || $j(\"img.xep6ejk\").length > 0 || $j(\".ed17d2qt .is65gj9g .myxxopco i.gneimcpu \").length > 0) {\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    }, 20, \"检测点赞按钮是否出现\");\r\n\r\n    if (flag) {\r\n        await hasDialog()\r\n        $Log(\"点赞专页\");\r\n        await wait(4);\r\n        if ($j(\".taijpn5t .tv7at329 .a0jftqn4 .du4w35lb .ni8dbmo4 \").length > 0) {\r\n            if ($j(\".taijpn5t .tv7at329 .a0jftqn4 .du4w35lb .ni8dbmo4 \")[0].innerText == \'讚\' || $j(\".taijpn5t .tv7at329 .a0jftqn4 .du4w35lb .ni8dbmo4 \")[0].innerText == \'赞\' || $j(\".taijpn5t .tv7at329 .a0jftqn4 .du4w35lb .ni8dbmo4 \")[0].innerText == \'Like\') {\r\n                $j(\".taijpn5t .tv7at329 .a0jftqn4 .du4w35lb .ni8dbmo4 \")[0].click();\r\n            } else if ($j(\".ta1k9048 .a0jftqn4 .hytbnt81 img.lzf7d6o1\").length > 0) {\r\n                $j(\".ta1k9048 .a0jftqn4 .hytbnt81 img.lzf7d6o1\")[0].click();\r\n            } else if ($j(\".pfnyh3mw img.eb18blue\").length > 0) {\r\n                $j(\".pfnyh3mw img.eb18blue\")[0].click();\r\n            } else if ($j(\".pfnyh3mw i.op6gxeva\").length > 0) {\r\n                $j(\".pfnyh3mw i.op6gxeva\")[0].click();\r\n            }\r\n\r\n            /* else if($j(\"div[aria-label=\'讚\']\").length > 0){\r\n                $j(\"div[aria-label=\'讚\']\")[0].click();\r\n            }else if($j(\"div[aria-label=\'赞\']\").length > 0){\r\n                $j(\"div[aria-label=\'赞\']\")[0].click();\r\n            }else if($j(\"div[aria-label=\'Like\']\")){\r\n                $j(\"div[aria-label=\'Like\']\")[0].click();\r\n            } */\r\n        } else if ($j(\"i.xi3auck\").length > 0) {\r\n            if ($j(\"img.xep6ejk\").length > 0) {\r\n                $j(\"img.xep6ejk\")[0].click();\r\n\r\n            } else if ($j(\"i.xi3auck\").length > 2) {\r\n                $j(\"i.xi3auck\")[1].click() // 点赞 点了赞自动关注专页 任务完成  正常模板 \r\n            } else {\r\n                $j(\"i.xi3auck\")[$j(\"i.xi3auck\").length - 1].click()\r\n            }\r\n        } else if ($j(\".x1w4ip6v i.xaj1gnb\").length > 0) {\r\n            $j(\".x1w4ip6v i.xaj1gnb\")[0].click();   // 只有关注按钮模板\r\n        } else if ($j(\"img.xep6ejk\").length > 0) {\r\n            $j(\"img.xep6ejk\")[0].click();   // 个人主页模板\r\n        } else if ($j(\".bxhmhvbv .is65gj9g .myxxopco i.ln9jdtaq \").length > 0) {\r\n            $j(\".bxhmhvbv .is65gj9g .myxxopco i.ln9jdtaq \")[0].click();\r\n        } else if ($j(\".ed17d2qt .is65gj9g .myxxopco i.gneimcpu \").length > 0) {\r\n            $j(\".ed17d2qt .is65gj9g .myxxopco i.gneimcpu \")[0].click();\r\n        }\r\n\r\n        await wait(7);\r\n        var len = $j(\".esuyzwwr .fl8dtwsd .j5wkysh0 .a57itxjd  .g0qnabr5\").length;  //已点赞的元素\r\n\r\n        if (len > 0) {\r\n            // 回调已经追踪还有更新时间\r\n            await callbackFollow(2);\r\n        } else if ($j(\"div[aria-label=\'已說讚\']\").length > 0) {\r\n            // 回调已经追踪还有更新时间\r\n            await callbackFollow(2);\r\n        } else if ($j(\"div[aria-label=\'赞了\']\").length > 0) {\r\n            await callbackFollow(2);\r\n        } else if ($j(\"div[aria-label=\'追蹤中\']\").length > 0) {\r\n            await callbackFollow(2);\r\n        } else if ($j(\"div[aria-label=\'Liked\']\").length > 0) {\r\n            await callbackFollow(2);\r\n        } else if ($j(\"div[aria-label=\'已赞\']\").length > 0) {\r\n            await callbackFollow(2);\r\n        }\r\n\r\n        await hasDialog()\r\n\r\n\r\n        await scrollLook(7, 12);\r\n\r\n        await wait(8);\r\n\r\n        CDC.setCache(\"count\", \"0\");\r\n\r\n        CDC.setCache(\"flag\", \"1\");\r\n\r\n        // await getcheckdata(0, 1)\r\n        CEFBG.close();\r\n    } else {\r\n        await callbackFollow(2);\r\n\r\n        await wait(8);\r\n\r\n        CDC.setCache(\"count\", \"0\");\r\n        CDC.setCache(\"flag\", \"1\");\r\n\r\n        CEFBG.close();\r\n        // await getcheckdata(0, 1)\r\n    }\r\n\r\n}\r\n\r\n$j(document).ready(function () {\r\n\r\n    if (CDC.getCache(\"flag\") == \"0\") {\r\n\r\n        if (CDC.getCache(\"count\") == \"0\") {\r\n            StartTask();\r\n        } else {\r\n            follow();\r\n        }\r\n\r\n\r\n    } else {\r\n\r\n        StartTask_2()\r\n\r\n    }\r\n\r\n})\r\n\r\nasync function hasDialog() {\r\n\r\n    \r\n\r\n    if($j(\'[role=\"dialog\"].x6ikm8r.x10wlt62.x71s49j\').length>0){\r\n        var text=$j(\'[role=\"dialog\"].x6ikm8r.x10wlt62.x71s49j\')[0].innerText;\r\n\r\n        if(text.includes(\"违反\")||text.includes(\"違反\")||text.includes(\"限制\") ||text.includes(\"限製\") ||text==\"\"|| text==\"确定\"||text==\"確定\" )\r\n        {\r\n            await callbackLoginStatus(1, -2);\r\n            await wait(5)\r\n            CEFBG.closeByError()\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\nasync function callbackLoginStatus(param, status) {\r\n    CEFBG.request(\"http://8.141.171.208/FansFBUser/FBUserCallback\", { id: id, is_login: param, status: status }, \"post\", \"json\", function (res) {\r\n        $Log(res);\r\n    });\r\n}\r\n\r\nasync function callbackFollow(param) {\r\n    CEFBG.request(\"http://101.201.222.226/AddFans/CbTaskState\", { id: taskid, state: param }, \"post\", \"form\", function (res) {\r\n        $Log(res);\r\n    });\r\n}\r\nasync function callbackLogs(param) {\r\n    var day = new Date();\r\n    var minutes = day.getMinutes();\r\n    minutes = minutes > 9 ? minutes : \'0\' + minutes;\r\n\r\n    var seconds = day.getSeconds();\r\n    seconds = seconds > 9 ? seconds : \'0\' + seconds;\r\n    var time = day.getFullYear() + \"/\" + (day.getMonth() + 1) + \"/\" + day.getDate() + \" \" + day.getHours() + \":\" + minutes + \":\" + seconds\r\n    param = param + \" (\" + time + \")\"\r\n    CEFBG.request(\"http://101.201.222.226/callback/addUpFansLogs\", { id: taskid, log: param }, \"post\", \"form\", function (res) {\r\n        $Log(res);\r\n        $Log(\"回调日志\")\r\n    });\r\n}\r\n\r\n\r\n//采集状态\r\nasync function StartTask_2() {\r\n\r\n\r\n    if ($j(\'[href=\"/login/\"]\').length > 0) {\r\n        $Log(\"没登录\")\r\n        await wait(2)\r\n        CEFBG.close()\r\n    }\r\n\r\n    await hasDialog()\r\n\r\n    var res1 = JSON.parse(CDC.getCache(\"data\"))\r\n    $Log(\"有数据\")\r\n    var data = res1.data\r\n    await wait(1)\r\n    if (data.length > 0) {\r\n        var url_2 = data[parseInt(CDC.getCache(\"count\"))].url;\r\n        if (CDC.getCache(\"type\") == \"0\") {\r\n            $Log(\"========================账号\")\r\n\r\n            if ($j(\'.xxbr6pl.x1p5oq8j\').length > 0 || $j(\'[role=\"link\"][href$=\"help\"]\').length > 0) {\r\n                if ($j(\'.xxbr6pl.x1p5oq8j\')[0].innerHTML.indexOf(\"已被移除\") > -1 || $j(\'.xxbr6pl.x1p5oq8j\')[0].innerHTML.indexOf(\"删除了\") > -1 || $j(\'.xxbr6pl.x1p5oq8j\')[0].innerHTML.indexOf(\"刪除\") > -1 || $j(\'[role=\"link\"][href$=\"help\"]\').length > 0) {\r\n                    $Log(\'=============内容无法显示================\')\r\n\r\n                    await wait(1)\r\n                    var id = data[parseInt(CDC.getCache(\"count\"))].id\r\n                    var param = {\r\n                        type: 0,\r\n                        id: id,\r\n                        state: 0,\r\n\r\n                    }\r\n                    await wait(2)\r\n\r\n                    await updatecheckstate(param, url_2)\r\n\r\n                }\r\n            } else {\r\n\r\n                $Log(\"开始传数据\")\r\n\r\n                await wait(1)\r\n                var fbid = 0\r\n                var fans = 0\r\n                if (data[parseInt(CDC.getCache(\"count\"))].url.indexOf(\'id=\') > -1)\r\n                    fbid = data[parseInt(CDC.getCache(\"count\"))].url.split(\'id=\')[1]\r\n\r\n                if ($j(\'.x1l90r2v.x1ve1bff .x1cy8zhl.xyamay9 span a[href*=\"/friends/\"]\').length > 0) {\r\n                    fans = $j(\'.x1l90r2v.x1ve1bff .x1cy8zhl.xyamay9 span a[href*=\"/friends/\"]\')[0].innerText.split(\' \')[0]\r\n                    if (fans.indexOf(\',\') > -1) {\r\n                        fans = fans.replace(/,/g, \'\')\r\n                    }\r\n\r\n                } else {\r\n                    fans = 0\r\n                }\r\n\r\n\r\n                var id = data[parseInt(CDC.getCache(\"count\"))].id\r\n                var param = {\r\n                    type: 0,\r\n                    id: id,\r\n                    state: 1,\r\n                    fbid: fbid,\r\n                    fans: fans\r\n                }\r\n                await wait(2)\r\n\r\n                await updatecheckstate(param, url_2)\r\n\r\n\r\n\r\n\r\n            }\r\n        } else if (CDC.getCache(\"type\") == \"1\") {\r\n            $Log(\"========================专页\")\r\n\r\n            var url_2 = data[parseInt(CDC.getCache(\"count\"))].url;\r\n            if ($j(\'.xxbr6pl.x1p5oq8j\').length > 0 || $j(\'[role=\"link\"][href$=\"help\"]\').length > 0) {\r\n                if ($j(\'.xxbr6pl.x1p5oq8j\')[0].innerHTML.indexOf(\"已被移除\") > -1 || $j(\'.xxbr6pl.x1p5oq8j\')[0].innerHTML.indexOf(\"删除了\") > -1 || $j(\'.xxbr6pl.x1p5oq8j\')[0].innerHTML.indexOf(\"刪除\") > -1 || $j(\'[role=\"link\"][href$=\"help\"]\').length > 0) {\r\n                    $Log(\'=============内容无法显示================\')\r\n                    var id = data[parseInt(CDC.getCache(\"count\"))].id\r\n                    var param = {\r\n                        type: 1,\r\n                        id: id,\r\n                        state: 0,\r\n                    }\r\n                    await wait(2)\r\n\r\n                    await updatecheckstate(param, url_2)\r\n\r\n\r\n\r\n\r\n                }\r\n            } else {\r\n                await wait(1, \"flag=2\")\r\n                var fbid = data[parseInt(CDC.getCache(\"count\"))].pageid\r\n                var fans = 0;\r\n                if ($j(\'.x1l90r2v.x1ve1bff .x1cy8zhl.xyamay9 span a[href*=\"followers\"]\').length > 0) {\r\n                    fans = getFansText($j(\'.x1l90r2v.x1ve1bff .x1cy8zhl.xyamay9 span a[href*=\"followers\"]\')[0].innerText)\r\n                } else if ($j(\'[class=\"x1jx94hy x78zum5 xdt5ytf\"] div.x78zum5.xdt5ytf.xl56j7k\').length > 0) {\r\n\r\n                    if ($j(\'[class=\"x1jx94hy x78zum5 xdt5ytf\"] div.x78zum5.xdt5ytf.xl56j7k\').length > 1) {\r\n                        fans = getFansText($j(\'[class=\"x1jx94hy x78zum5 xdt5ytf\"] div.x78zum5.xdt5ytf.xl56j7k\')[1].innerText)\r\n                    } else {\r\n                        fans = getFansText($j(\'[class=\"x1jx94hy x78zum5 xdt5ytf\"] div.x78zum5.xdt5ytf.xl56j7k\')[0].innerText)\r\n                    }\r\n                }\r\n\r\n\r\n                var id = data[parseInt(CDC.getCache(\"count\"))].id\r\n                var param = {\r\n                    type: 1,\r\n                    id: id,\r\n                    state: 1,\r\n                    fbid: fbid,\r\n                    fans: fans\r\n                }\r\n                await wait(2)\r\n                await updatecheckstate(param, url_2)\r\n\r\n\r\n\r\n            }\r\n\r\n\r\n        } else {\r\n            $Log(\"任务完成\")\r\n        }\r\n    } else {\r\n\r\n        $Log(\"type：\" + CDC.getCache(\"type\"))\r\n        await wait(4)\r\n        CEFBG.close()\r\n        // $Log(\"结束\")\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n//获取任务\r\n\r\n// type={1为专页 0为账号}\r\nasync function getcheckdata(type, count) {\r\n    CEFBG.request(\"http://fb.zhentoo.com/api/getcheckdata\", { type: type, count: count }, \"post\", \"form\", async function (res) {\r\n        $Log(\"数据\" + res)\r\n        CDC.setCache(\"data\", res);\r\n        await wait(1)\r\n        var data = JSON.parse(res).data\r\n        window.location = data[parseInt(CDC.getCache(\"count\"))].url\r\n    });\r\n}\r\n// http://fb.zhentoo.com/api/updatecheckstate?type={1为专页 0为账号}&id=&state={1正常 0异常}&fbid={long类型}&fans={专页粉丝数}\r\n// {type:type,id:id,state:state,fbid:fbid,fans:fans}\r\n//回调采集任务\r\nasync function updatecheckstate(param, url) {\r\n\r\n    \r\n    if (window.location.href.indexOf(\"chrome-error\") > -1) {\r\n        $Log(\"===本地链接有问题直接关了===\")\r\n        callbackLogs(\" fbid:\" + param.fbid + \"。link:\" + url + \"。state:\" + param.state + \"本地连接:\" + window.location.href + \";本地链接有问题直接关了\")\r\n        CEFBG.close()\r\n    } else {\r\n        $Log(\"回调\")\r\n        $Log(JSON.stringify(param))\r\n        CEFBG.request(\"http://fb.zhentoo.com/api/updatecheckstate\", param, \"post\", \"form\", async function (res) {\r\n            $Log(res);\r\n            // res1=JSON.parse(res)\r\n            // $Log(\"数据\"+res1.data)\r\n            if (param.type == 1) {\r\n                $Log(\"==========专页\")\r\n            }\r\n            else if (param.type == 0) {\r\n                $Log(\"==========账号\")\r\n\r\n            }\r\n            callbackLogs(\" fbid:\" + param.fbid + \"。link:\" + url + \"。state:\" + param.state + \"本地连接:\" + window.location.href + \";\")\r\n\r\n            $Log(\"    id: \" + param.id)\r\n            $Log(\"  fbid: \" + param.fbid + \" state: \" + param.state)\r\n            $Log(\" state: \" + param.state)\r\n            $Log(\"粉丝数: \" + param.fans)\r\n            $Log(\"  类型: \" + param.type)\r\n            var n = parseInt(CDC.getCache(\"type\")) + 1;\r\n            CDC.setCache(\"type\", n.toString())\r\n            CDC.setCache(\"data\", \"\");\r\n            CDC.setCache(\"count\", \"0\")\r\n            await scrollLook(5, 8);\r\n            await wait(4)\r\n            if (CDC.getCache(\"type\") == \"2\") {\r\n                CEFBG.close()\r\n                // $Log(\"结束\")\r\n            } else if (CDC.getCache(\"type\") == \"1\") {\r\n                await getcheckdata(1, 1)\r\n            }\r\n\r\n        });\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\n// 等待时间\r\nasync function wait(s, w = \'\') {\r\n    let t = s\r\n    if (t >= 60) {\r\n        t = t / 60\r\n        t = t.toFixed(2)\r\n        $Log(`开始脚本等待` + t + \"分,\" + w);\r\n    } else {\r\n        $Log(`开始脚本等待` + t + \"秒,\" + w);\r\n    }\r\n    return new Promise(resolve => {\r\n        setTimeout(function () {\r\n            $Log(`结束脚本等待${t},` + w);\r\n            resolve();\r\n        }, s * 1000);\r\n    });\r\n}\r\n\r\n// 下拉最后回到开头\r\nasync function scrollLook(min, max, callback, delay) {\r\n    var delaytime = delay != null && delay > 0 ? delay : 2000\r\n    var math = Math.ceil(Math.random() * (max - min)) + min;\r\n    $Log(\"滑动\" + math)\r\n    for (var i = 1; i < math + 1; i++) {\r\n        (function (i) {\r\n            setTimeout(() => {\r\n                $Log(\'---滚动-->\' + i)\r\n                $j(\'html,body\').animate({\r\n                    scrollTop: i * 700\r\n                })\r\n\r\n                if (i === math) {\r\n                    $j(\'html,body\').animate({\r\n                        scrollTop: 0\r\n                    })\r\n                    if (callback != null) {\r\n                        callback()\r\n                    }\r\n\r\n                }\r\n            }, i * delaytime)\r\n        })(i)\r\n    }\r\n}\r\n\r\n\r\nfunction waitCondition(check_func, max_sec, msg) {\r\n    msg = msg ? `(${msg})` : \'\';\r\n    $Log(msg + \" 条件检测 【开始】 最多等待\" + max_sec + \" 秒\");\r\n    return new Promise(resolve => {\r\n        var count = 0;\r\n        var inteval = setInterval(function () {\r\n            var state = check_func();\r\n            count++;\r\n            if (state) {\r\n                $Log(msg + \' 条件检测 【结束】 耗时 \' + count + \" 秒\");\r\n                resolve(true);\r\n                clearInterval(inteval);\r\n            } else {\r\n                $Log(msg + \' 条件检测 【进行中】......\');\r\n            }\r\n            if (count > max_sec) {\r\n                $Log(msg + \' 条件检测 【超时】!!!!!!\');\r\n                resolve(false);//失败\r\n                clearInterval(inteval);\r\n            }\r\n        }, 1000);\r\n    });\r\n\r\n}\r\n// 101461212656826\r\n\r\n// 9,888人在追蹤\r\n\r\n// var fans=0\r\n// $j(\'[class=\"x1jx94hy x78zum5 xdt5ytf\"] div.x78zum5.xdt5ytf.xl56j7k\')[1].innerText;\r\n// fans=$j(\'.x1l90r2v.x1ve1bff .x1cy8zhl.xyamay9 span a[href*=\"followers\"]\')[0].innerText\r\n// getFansText(fans)\r\n\r\n\r\nfunction getFansText(fans) {\r\n\r\n\r\n    if (fans.indexOf(\'位\') > -1 || fans.indexOf(\'人\') > -1) {\r\n        if (fans.indexOf(\'位\') > -1) {\r\n            fans = fans.split(\'位\')[0]\r\n\r\n            fans = dealFansNum(fans)\r\n\r\n        } else if (fans.indexOf(\'人\') > -1) {\r\n            fans = fans.split(\'人\')[0]\r\n\r\n            fans = dealFansNum(fans)\r\n        }\r\n\r\n\r\n\r\n        $Log(\"fans_1\" + fans)\r\n        return fans;\r\n\r\n    } else if (fans.indexOf(\'followers\') > -1) {\r\n        fans = fans.split(\'followers\')[0]\r\n        fans = dealFansNum(fans)\r\n\r\n        $Log(\"fans_1_2\" + fans)\r\n        return fans;\r\n    }\r\n    else if (fans.indexOf(\'people\') > -1) {\r\n        fans = fans.split(\'people\')[0]\r\n        fans = dealFansNum(fans)\r\n\r\n        $Log(\"fans_1_3\" + fans)\r\n        return fans;\r\n    } else {\r\n        $Log(\"fans_1_4\" + fans)\r\n\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n}\r\n\r\nfunction dealFansNum(fans) {\r\n\r\n    if (fans.indexOf(\",\") > -1) {\r\n        fans = fans.replace(/,/g, \'\')\r\n\r\n\r\n    }\r\n    var fans_1 = 0\r\n    if (fans.indexOf(\' \')) {\r\n\r\n        fans_1 = fans.split(\' \')[0]\r\n        $Log(fans)\r\n\r\n    } else if (fans.indexOf(\' \')) {\r\n\r\n        fans_1 = fans.split(\' \')[0]\r\n        $Log(fans)\r\n\r\n    } else {\r\n\r\n        $Log(fans)\r\n\r\n    }\r\n\r\n    if (fans.indexOf(\"万\") > -1 || fans.indexOf(\"萬\") > -1) {\r\n\r\n        $Log(parseFloat(fans_1) * 10000);\r\n\r\n        fans_1 = parseFloat(fans_1) * 10000\r\n    } else if (fans.indexOf(\"K\") > -1) {\r\n        $Log(parseFloat(fans_1) * 1000);\r\n\r\n        fans_1 = parseFloat(fans_1) * 1000\r\n\r\n    } else if (fans.indexOf(\"M\") > -1) {\r\n\r\n        $Log(parseFloat(fans_1) * 1000000);\r\n\r\n        fans_1 = parseFloat(fans_1) * 1000000\r\n    }\r\n\r\n    return fans_1;\r\n\r\n\r\n\r\n}\r\n\r\n\r\n\r\n\r\n\r\n', '2024-08-08 16:43:30');

SET FOREIGN_KEY_CHECKS = 1;
